<!DOCTYPE html>
<html lang="zh-Hant" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å°éµï½œæ™ºæ…§è»Šç«™çœ‹æ¿</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet" />
  
  <style>
    /* ===== 1. æ ¸å¿ƒè®Šæ•¸ ===== */
    :root {
      --font-main: 'Inter', 'Noto Sans TC', sans-serif;
      --radius: 12px;
      --transition: 0.2s ease;
    }

    :root[data-theme='light'] {
      --bg-body: #f3f4f6;
      --bg-card: #ffffff;
      --bg-header: rgba(255, 255, 255, 0.9);
      --text-main: #1f2937;
      --text-muted: #6b7280;
      --border: #e5e7eb;
      --primary: #2563eb;
      --primary-bg: #eff6ff;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --marquee-bg: #1f2937;
      --marquee-text: #f3f4f6;
    }

    :root[data-theme='dark'] {
      --bg-body: #111827;
      --bg-card: #1f2937;
      --bg-header: rgba(31, 41, 55, 0.9);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border: #374151;
      --primary: #60a5fa;
      --primary-bg: rgba(59, 130, 246, 0.15);
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
      --marquee-bg: #000000;
      --marquee-text: #fbbf24;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    
    body {
      font-family: var(--font-main);
      background: var(--bg-body);
      color: var(--text-main);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden; /* å›ºå®šè¦–çª—ï¼Œå…§å®¹æ²å‹• */
    }

    a { text-decoration: none; color: inherit; }

    /* ===== 2. å°èˆªåˆ— ===== */
    .app-header {
      flex: 0 0 auto;
      background: var(--bg-header);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--border);
      z-index: 50;
    }
    .nav-wrap {
      max-width: 1400px; margin: 0 auto; padding: 0.75rem 1rem;
      display: flex; align-items: center; justify-content: space-between;
    }
    .brand { font-weight: 800; font-size: 1.2rem; color: var(--primary); display: flex; align-items: center; gap: 8px; }
    .brand::before { content:'ğŸš†'; font-size: 1.4rem; }

    .tabs { display: flex; gap: 4px; overflow-x: auto; padding-bottom: 4px; }
    .tab {
      font-size: 0.9rem; font-weight: 500; color: var(--text-muted);
      padding: 6px 12px; border-radius: 6px; white-space: nowrap;
      transition: var(--transition);
    }
    .tab:hover { background: var(--bg-body); color: var(--primary); }
    .tab.active { background: var(--primary-bg); color: var(--primary); font-weight: 600; }

    .actions { display: flex; gap: 8px; }
    .action-btn {
      background: var(--bg-card); border: 1px solid var(--border); color: var(--text-main);
      padding: 6px 12px; border-radius: 8px; font-size: 0.85rem; font-weight: 600;
      cursor: pointer; display: flex; align-items: center; gap: 6px; transition: var(--transition);
    }
    .action-btn:hover { border-color: var(--text-muted); }
    .action-btn.primary { background: var(--primary); color: white; border-color: var(--primary); }
    
    /* ===== 3. ä¸»è¦å…§å®¹å€ ===== */
    .main-container {
      flex: 1 1 auto;
      display: flex; flex-direction: column;
      max-width: 1400px; width: 100%; margin: 0 auto;
      padding: 1rem; gap: 1rem;
      overflow: hidden; /* å…§éƒ¨æ²å‹• */
    }

    /* æ§åˆ¶é¢æ¿ Dashboard */
    .dashboard-panel {
      flex: 0 0 auto;
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 1rem;
      display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem; align-items: end;
      box-shadow: var(--shadow);
    }

    .control-group { display: flex; flex-direction: column; gap: 6px; }
    .control-label { font-size: 0.75rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    
    select {
      width: 100%; padding: 10px; border-radius: 8px;
      border: 1px solid var(--border); background: var(--bg-body); color: var(--text-main);
      font-size: 1rem; outline: none; appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat; background-position: right 10px center; background-size: 16px;
    }

    .fav-btn {
      margin-top: 4px; width: 100%; padding: 8px; border-radius: 6px; border: 1px dashed var(--border);
      background: transparent; color: var(--text-muted); cursor: pointer; font-size: 0.85rem;
    }
    .fav-btn.active { color: #f59e0b; border-color: #f59e0b; background: rgba(245, 158, 11, 0.1); }

    /* æ•¸å­—æ™‚é˜ */
    .digital-clock {
      display: flex; flex-direction: column; align-items: flex-end; justify-content: center;
      background: var(--bg-body); border-radius: 8px; padding: 0.5rem 1rem;
      border: 1px solid var(--border);
    }
    .clock-time { font-size: 2rem; font-weight: 800; font-variant-numeric: tabular-nums; line-height: 1; color: var(--text-main); }
    .clock-station { font-size: 0.9rem; color: var(--text-muted); font-weight: 500; margin-top: 4px; }

    /* æ™‚åˆ»è¡¨å¡ç‰‡ */
    .schedule-card {
      flex: 1 1 auto;
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: flex; flex-direction: column;
      overflow: hidden; /* è¡¨æ ¼æ²å‹• */
    }

    .table-header {
      background: var(--bg-body); border-bottom: 1px solid var(--border);
      padding: 12px 16px;
      display: grid; grid-template-columns: 1.2fr 1.5fr 2fr 1fr 1.2fr;
      font-weight: 600; color: var(--text-muted); font-size: 0.9rem;
    }

    .table-body {
      flex: 1; overflow-y: auto;
    }

    .table-row {
      display: grid; grid-template-columns: 1.2fr 1.5fr 2fr 1fr 1.2fr;
      padding: 14px 16px; border-bottom: 1px solid var(--border);
      align-items: center; transition: background 0.1s;
      font-size: 1.1rem; color: var(--text-main);
    }
    .table-row:nth-child(even) { background: rgba(0,0,0,0.01); }
    .table-row:hover { background: var(--primary-bg); }

    /* è¡¨æ ¼æ¬„ä½æ¨£å¼ */
    .col-train { font-weight: 700; font-family: monospace; display: flex; align-items: center; gap: 6px; }
    .col-dest { font-weight: 600; }
    .col-time { font-weight: 700; font-family: monospace; letter-spacing: 1px; }
    .col-status { font-weight: 700; }
    
    .status-ok { color: var(--text-muted); font-size: 0.9rem; }
    .status-soon { color: #f59e0b; animation: pulse 2s infinite; }
    .status-now { color: #ef4444; font-weight: 800; animation: flash 1s infinite; }

    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.6} }
    @keyframes flash { 0%,100%{opacity:1; color:#ef4444} 50%{opacity:0.5; color:#b91c1c} }

    /* è·‘é¦¬ç‡ˆ */
    .marquee-container {
      flex: 0 0 auto;
      background: var(--marquee-bg);
      color: var(--marquee-text);
      padding: 12px 0;
      overflow: hidden;
      font-size: 1.1rem;
      font-weight: 500;
      white-space: nowrap;
      position: relative;
      border-top: 1px solid var(--border);
    }
    .marquee-content {
      display: inline-block;
      padding-left: 100%;
      animation: marquee 25s linear infinite;
    }
    @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

    /* è»Šç¨®æ–‡å­—é¡è‰² (ç„¡æ–¹æ¡†) */
    .train-type-text { font-weight: 700; font-size: 1.05rem; }
    
    .text-zq { color: #ef4444; }   /* è‡ªå¼· Red */
    .text-pym { color: #db2777; }  /* æ™®æ‚ ç‘ª Pink */
    .text-xzq { color: #8b5cf6; }  /* æ–°è‡ªå¼· Purple */
    .text-jg { color: #f59e0b; }   /* è’å…‰ Orange */
    .text-qj { color: var(--text-main); } /* å€é–“ (è·Ÿéš¨ä¸»é¡Œ) */
    .text-qjk { color: #10b981; }  /* å€é–“å¿« Green */
    .text-fx { color: #3b82f6; }   /* å¾©èˆˆ Blue */

    /* é–ƒçˆåœ“é» */
    .dot-flash {
      width: 8px; height: 8px; background: #ef4444; border-radius: 50%;
      box-shadow: 0 0 8px #ef4444;
    }

    /* ===== çœ‹æ¿æ¨¡å¼ (Board Mode) ===== */
    body[data-board="on"] .app-header,
    body[data-board="on"] .dashboard-panel,
    body[data-board="on"] .fav-btn {
      display: none !important;
    }
    
    body[data-board="on"] {
      background: #000; color: #fff;
    }
    body[data-board="on"] .main-container {
      padding: 0; margin: 0; max-width: 100%; height: 100vh;
    }
    body[data-board="on"] .schedule-card {
      border: none; border-radius: 0; height: 100%; background: #000;
    }
    body[data-board="on"] .table-header {
      background: #111; color: #888; border-color: #333; font-size: 1.4rem;
    }
    body[data-board="on"] .table-row {
      border-color: #222; font-size: 2.2rem; padding: 24px; color: #fff;
    }
    body[data-board="on"] .table-row:nth-child(even) { background: #0a0a0a; }
    body[data-board="on"] .train-type-text { font-size: 2.2rem; }
    body[data-board="on"] .marquee-container {
      background: #111; color: #fbbf24; font-size: 1.8rem; padding: 16px 0; border-top: 2px solid #333;
    }
    /* çœ‹æ¿æ¨¡å¼ä¸‹ï¼Œå€é–“è»Šå¼·åˆ¶ç™½è‰²ä»¥åˆ©é–±è®€ */
    body[data-board="on"] .text-qj { color: #fff; }
    
    .exit-board-btn {
      position: fixed; top: 20px; right: 20px; z-index: 1000;
      background: rgba(255,255,255,0.2); color: #fff;
      border: 1px solid rgba(255,255,255,0.4);
      padding: 8px 16px; border-radius: 8px; cursor: pointer;
      display: none;
    }
    body[data-board="on"] .exit-board-btn { display: block; }

    /* RWD */
    @media (max-width: 768px) {
      .table-header, .table-row {
        grid-template-columns: 1.1fr 1.3fr 1.2fr 1fr 1.2fr;
      }
      .dashboard-panel { grid-template-columns: 1fr; }
      .digital-clock { align-items: center; margin-top: 10px; }
    }
  </style>
</head>
<body>

  <button class="exit-board-btn" id="exitBoardBtn">é€€å‡ºçœ‹æ¿æ¨¡å¼</button>

  <header class="app-header">
    <div class="nav-wrap">
      <div class="brand">å°éµæ™ºæ…§çœ‹æ¿</div>
      <nav class="tabs">
        <a class="tab" href="index-tra.transfer.html">è½‰ä¹˜æŸ¥è©¢</a>
        <a class="tab" href="index-tra.move.html">åˆ—è»Šå‹•æ…‹</a>
        <a class="tab active">è»Šç«™çœ‹æ¿</a>
        <a class="tab" href="index-tra.table.html">æ™‚åˆ»ç¸½è¡¨</a>
        <a href="index-speed.html">é«˜éµæ™‚åˆ»è¡¨</a>
    <a href="index-thsr.html">é«˜éµæ™‚åˆ»è¡¨(å°ˆç”¨)</a>
    <a href="index.html">æ™‚åˆ»è¡¨</a>
    <a href="index-tra.transfer.html">æ™‚åˆ»è¡¨(å«é‹ç”¨)</a>
    <a href="index-tra.easy.html">ç°¡å¼æ™‚åˆ»è¡¨</a>
    <a href="index-tra.type.html">ä¾è»Šç¨®æ™‚åˆ»è¡¨</a>
    <a href="train-info.html">è»Šç«™è³‡è¨Šæ¿</a>
    <a href="people.html">é‹é‡æŸ¥è©¢</a>
    <a href="index.trainrate.html">é‹ç”¨ç‡æŸ¥è©¢</a>
    <a href="index-tra.book.html">è¨‚ç¥¨ç³»çµ±</a>
    <a href="index-tra.make.html">åˆ—è»Šæ’é»</a>
      </nav>
      <div class="actions">
        <button id="boardModeBtn" class="action-btn">ğŸ“º çœ‹æ¿æ¨¡å¼</button>
        <button id="themeBtn" class="action-btn primary">â—‘</button>
      </div>
    </div>
  </header>

  <main class="main-container">
    <section class="dashboard-panel">
      <div class="control-group">
        <label class="control-label">è»Šç«™ Station</label>
        <select id="stationSelect"></select>
        <button id="favBtn" class="fav-btn">â˜† åŠ å…¥å¸¸ç”¨è»Šç«™</button>
      </div>
      <div class="control-group">
        <label class="control-label">æ–¹å‘ Direction</label>
        <select id="directionSelect">
          <option value="north">åŒ—ä¸Š (Northbound)</option>
          <option value="south">å—ä¸‹ (Southbound)</option>
        </select>
      </div>
      <div class="digital-clock">
        <div class="clock-time" id="clockTime">--:--:--</div>
        <div class="clock-station" id="clockStation">å°åŒ— ï½œ åŒ—ä¸Š</div>
      </div>
    </section>

    <section class="schedule-card">
      <div class="table-header">
        <div>è»Šæ¬¡</div>
        <div>è»Šç¨®</div>
        <div>é–‹å¾€</div>
        <div style="text-align:center">ç‹€æ…‹</div>
        <div style="text-align:right">é–‹è»Šæ™‚é–“</div>
      </div>
      <div class="table-body" id="trainList">
        <div style="padding:40px; text-align:center; color:var(--text-muted)">è¼‰å…¥ä¸­...</div>
      </div>
      
      <div class="marquee-container">
        <div class="marquee-content" id="marqueeText">
          ç³»çµ±é€£ç·šä¸­... æ­¡è¿ä½¿ç”¨å°éµæ™ºæ…§çœ‹æ¿ç³»çµ±...
        </div>
      </div>
    </section>
  </main>

  <script src="train-schedule.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // DOM Elements
      const stationSel = document.getElementById('stationSelect');
      const dirSel = document.getElementById('directionSelect');
      const clockTimeEl = document.getElementById('clockTime');
      const clockStationEl = document.getElementById('clockStation');
      const listEl = document.getElementById('trainList');
      const marqueeEl = document.getElementById('marqueeText');
      const themeBtn = document.getElementById('themeBtn');
      const boardBtn = document.getElementById('boardModeBtn');
      const exitBoardBtn = document.getElementById('exitBoardBtn');
      const favBtn = document.getElementById('favBtn');

      // 1. åˆå§‹åŒ–è³‡æ–™é©—è­‰
      if (typeof trainSchedule === 'undefined' || typeof stations === 'undefined') {
        listEl.innerHTML = '<div style="padding:20px;text-align:center;color:red">æ‰¾ä¸åˆ°è³‡æ–™æª” (train-schedule.js)</div>';
        return;
      }

      // 2. å¡«å……è»Šç«™é¸å–® & å¸¸ç”¨è»Šç«™é‚è¼¯
      function getFavs() { return JSON.parse(localStorage.getItem('favStations') || '[]'); }
      function toggleFav() {
        const s = stationSel.value;
        const favs = getFavs();
        const idx = favs.indexOf(s);
        if (idx >= 0) favs.splice(idx, 1); else favs.push(s);
        localStorage.setItem('favStations', JSON.stringify(favs));
        renderStationOptions();
        updateFavBtn();
      }

      function renderStationOptions() {
        const currentVal = stationSel.value;
        stationSel.innerHTML = '';
        const favs = new Set(getFavs());
        
        // å¸¸ç”¨ç¾¤çµ„
        if (favs.size > 0) {
          const grpFav = document.createElement('optgroup');
          grpFav.label = 'â˜… å¸¸ç”¨è»Šç«™';
          stations.forEach(s => {
            if (favs.has(s)) grpFav.appendChild(new Option(s, s));
          });
          stationSel.appendChild(grpFav);
        }
        // å…¨éƒ¨ç¾¤çµ„
        const grpAll = document.createElement('optgroup');
        grpAll.label = 'æ‰€æœ‰è»Šç«™';
        stations.forEach(s => grpAll.appendChild(new Option(s, s)));
        stationSel.appendChild(grpAll);

        if (currentVal && Array.from(stationSel.options).some(o => o.value === currentVal)) {
          stationSel.value = currentVal;
        } else if (stations.includes("è‡ºåŒ—")) {
          stationSel.value = "è‡ºåŒ—";
        }
      }

      function updateFavBtn() {
        const isFav = getFavs().includes(stationSel.value);
        favBtn.textContent = isFav ? 'â˜… å·²æ”¶è—' : 'â˜† åŠ å…¥å¸¸ç”¨è»Šç«™';
        favBtn.classList.toggle('active', isFav);
      }

      renderStationOptions();
      updateFavBtn();
      favBtn.onclick = toggleFav;

      // 3. æ ¸å¿ƒé‚è¼¯ï¼šæ‰¾ä¸‹ä¸€ç­è»Š (å³æ™‚éš±è—éæœŸç­æ¬¡)
      function getNextTrains(station, direction) {
        const now = new Date();
        const curMin = now.getHours() * 60 + now.getMinutes();
        const list = [];

        Object.entries(trainSchedule).forEach(([no, data]) => {
          // æ–¹å‘åˆ¤æ–·ï¼šå¶æ•¸åŒ—ä¸Šï¼Œå¥‡æ•¸å—ä¸‹
          const isNorth = (parseInt(no) % 2 === 0);
          if ((direction === 'north' && !isNorth) || (direction === 'south' && isNorth)) return;

          const stops = data['è»Šç«™æ™‚é–“'];
          const stopIdx = stops.findIndex(s => s[0] === station);
          
          if (stopIdx !== -1 && stopIdx < stops.length - 1) { // å¿…é ˆæœ‰åœä¸”ä¸æ˜¯çµ‚é»
            const timeStr = stops[stopIdx][1];
            const [h, m] = timeStr.split(':').map(Number);
            let min = h * 60 + m;
            
            // è™•ç†è·¨æ—¥ï¼šè‹¥æ™‚é–“å·®è¶…é 12 å°æ™‚ (å¦‚ç¾åœ¨23:00, è»Šæ¬¡00:10)ï¼Œè¦–ç‚ºéš”å¤©
            let diff = min - curMin;
            if (diff < -720) min += 1440; 
            diff = min - curMin;

            // âš ï¸ é—œéµä¿®æ”¹ï¼šåªé¡¯ç¤º diff > 0 (æœªä¾†ç­æ¬¡)ï¼Œæ™‚é–“ä¸€åˆ°(<=0)ç«‹å³éš±è—
            if (diff > 0 && diff < 360) { // é¡¯ç¤º æœªä¾† 1 åˆ†é˜ ~ æœªä¾† 6 å°æ™‚
              list.push({
                no,
                type: data['è»Šç¨®'],
                dest: stops[stops.length - 1][0],
                time: timeStr,
                min: min,
                diff: diff,
                stops: stops.slice(stopIdx + 1).map(s => s[0])
              });
            }
          }
        });

        return list.sort((a, b) => a.min - b.min).slice(0, 10); // å–å‰ 10 ç­
      }

      // 4. æ¸²æŸ“ç•«é¢
      function render() {
        const st = stationSel.value;
        const dir = dirSel.value;
        const trains = getNextTrains(st, dir);
        
        // æ›´æ–°æ™‚é˜èˆ‡æ¨™é¡Œ
        const now = new Date();
        clockTimeEl.innerText = now.toLocaleTimeString('en-US', { hour12: false });
        clockStationEl.innerText = `${st} ï½œ ${dir === 'north' ? 'åŒ—ä¸Š Northbound' : 'å—ä¸‹ Southbound'}`;

        // æ›´æ–°åˆ—è¡¨
        listEl.innerHTML = '';
        if (trains.length === 0) {
          listEl.innerHTML = `<div style="padding:40px;text-align:center;font-size:1.2rem;color:var(--text-muted)">ç›®å‰ç„¡åˆ—è»Šè³‡è¨Š / Service Ends</div>`;
          marqueeEl.innerText = `ç¾åœ¨æ™‚åˆ» ${now.toLocaleTimeString()}ï¼Œç›®å‰ç„¡åˆ—è»Šè³‡è¨Šã€‚`;
          return;
        }

        trains.forEach((t, idx) => {
          const row = document.createElement('div');
          row.className = 'table-row';
          
          // Color Class (Text Only)
          let typeClass = 'text-qj';
          if (t.type.includes('æ–°è‡ªå¼·')) typeClass = 'text-xzq';
          else if (t.type.includes('æ™®æ‚ ç‘ª')) typeClass = 'text-pym';
          else if (t.type.includes('è‡ªå¼·')) typeClass = 'text-zq';
          else if (t.type.includes('è’å…‰')) typeClass = 'text-jg';
          else if (t.type.includes('å€é–“å¿«')) typeClass = 'text-qjk';
          else if (t.type.includes('å¾©èˆˆ')) typeClass = 'text-fx';

          // ç‹€æ…‹æ–‡å­— (ä¾ä½¿ç”¨è€…éœ€æ±‚èª¿æ•´)
          let statusHtml = `<span class="status-ok">${t.diff} åˆ†</span>`;
          if (t.diff <= 1) {
            statusHtml = `<span class="status-now">å³å°‡é–‹è»Š</span>`;
          } else if (t.diff <= 3) {
            statusHtml = `<span class="status-now">é€²ç«™ä¸­</span>`;
          } else if (t.diff <= 5) {
            statusHtml = `<span class="status-soon">å³å°‡é€²ç«™</span>`;
          }

          // é–ƒçˆé» (ç¬¬ä¸€ç­)
          const dot = (idx === 0 && t.diff <= 3) ? `<div class="dot-flash"></div>` : ``;

          row.innerHTML = `
            <div class="col-train">${dot} ${t.no}</div>
            <div class="col-type"><span class="train-type-text ${typeClass}">${t.type}</span></div>
            <div class="col-dest">${t.dest}</div>
            <div class="col-status" style="text-align:center">${statusHtml}</div>
            <div class="col-time" style="text-align:right">${t.time}</div>
          `;
          listEl.appendChild(row);
        });

        // æ›´æ–°è·‘é¦¬ç‡ˆ (é¡¯ç¤ºå…¨ç«™ï¼Œç§»é™¤è‹±æ–‡)
        const f = trains[0];
        const stopText = f.stops.join('ã€'); 
        marqueeEl.innerHTML = `
          <span style="color:#fbbf24; font-weight:700">${f.time}</span> é–‹å¾€ ${f.dest} çš„ ${f.no}æ¬¡ ${f.type} å³å°‡é€²ç«™ã€‚
          æ²¿é€”åœé ï¼š${stopText}ã€‚
        `;
      }

      // 5. äº‹ä»¶ç›£è½
      stationSel.onchange = () => { render(); updateFavBtn(); };
      dirSel.onchange = render;
      
      // ä¸»é¡Œåˆ‡æ›
      themeBtn.onclick = () => {
        const cur = document.documentElement.getAttribute('data-theme');
        document.documentElement.setAttribute('data-theme', cur === 'dark' ? 'light' : 'dark');
      };

      // çœ‹æ¿æ¨¡å¼
      function toggleBoard(on) {
        if (on) document.body.setAttribute('data-board', 'on');
        else document.body.removeAttribute('data-board');
      }
      boardBtn.onclick = () => toggleBoard(true);
      exitBoardBtn.onclick = () => toggleBoard(false);
      
      // éµç›¤ ESC é€€å‡º
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') toggleBoard(false);
      });

      // å•Ÿå‹•
      setInterval(render, 1000);
      render();
    });
  </script>
</body>
</html>