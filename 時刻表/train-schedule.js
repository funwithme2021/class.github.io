

var trainSchedule = {
  //新自強3xx

  //普悠瑪2xx
  '201': {
      '車種': '普悠瑪',
      '車站時間': [
          ['南港', '07:42'],['松山', '07:48'],['臺北', '21:00'],['萬華', '08:05'],['板橋', '08:10'],
          ['桃園', '08:26'],['臺中', '09:40'],['嘉義', '10:36'],['臺南', '11:12'],['高雄', '11:42'],
          ['屏東', '11:57'],['潮州', '12:12'],['枋寮', '12:33']
      ]
  },
  '203': {
    '車種': '普悠瑪',
    '車站時間': [
        ['南港', '12:45'],['松山', '12:49'],['臺北', '13:00'],['萬華', '13:05'],['板橋', '13:10'],
        ['臺中', '14:48'],['嘉義', '15:49'],['臺南', '16:27'],['高雄', '17:00'],
        ['屏東', '17:20'],['潮州', '17:35']
    ]
  },
  '205': {
    '車種': '普悠瑪',
    '車站時間': [
        ['南港', '18:25'],['松山', '18:30'],['臺北', '18:40'],['萬華', '18:45'],['板橋', '18:51'],
        ['新竹', '19:32'],['臺中', '20:28'],['嘉義', '21:10'],['臺南', '21:43'],['高雄', '22:11'],
        ['屏東', '22:26'],['潮州', '22:30']
    ]
  },
  '221': {
    '車種': '普悠瑪',
    '車站時間': [
        ['花蓮', '05:25'],['羅東', '06:30'],['宜蘭', '06:40'],['七堵', '07:30'],
        ['松山', '07:45'],['臺北', '07:51'],['萬華', '07:56'],['板橋', '08:02'],['樹林', '08:10']
    ]
  },
  '223': {
    '車種': '普悠瑪',
    '車站時間': [
        ['花蓮', '06:25'],['新城', '06:42'],['羅東', '07:30'],['宜蘭', '07:40'],
        ['礁溪', '07:47'],['頭城', '07:52'],['八堵', '08:35'],
        ['松山', '08:45'],['臺北', '08:51'],['萬華', '08:56'],['板橋', '09:02'],['樹林', '09:10']
    ]
  },
  '225': {
    '車種': '普悠瑪',
    '車站時間': [
        ['花蓮', '10:25'],['羅東', '11:30'],['宜蘭', '11:40'],['七堵', '12:30'],
        ['松山', '12:45'],['臺北', '12:51'],['萬華', '12:56'],['板橋', '13:02'],
        ['桃園', '13:21'],['新竹', '13:45'],
        ['豐原', '14:20'],['臺中', '14:31'],['彰化', '14:42']
    ]
  },
  '227': {
    '車種': '普悠瑪',
    '車站時間': [
        ['花蓮', '11:25'],['新城', '11:42'],['羅東', '12:30'],['宜蘭', '12:40'],
        ['松山', '13:45'],['臺北', '13:51'],['萬華', '13:56'],['板橋', '14:02'],['樹林', '14:10']
    ]
  },
  '229': {
    '車種': '普悠瑪',
    '車站時間': [
        ['花蓮', '13:25'],['羅東', '14:30'],['宜蘭', '14:40'],['七堵', '15:30'],
        ['松山', '15:45'],['臺北', '15:51'],['萬華', '15:56'],['板橋', '16:02'],
        ['豐原', '17:26'],['臺中', '17:38'],['彰化', '17:50']
    ]
  },
  '231': {
    '車種': '普悠瑪',
    '車站時間': [
        ['花蓮', '16:25'],['新城', '16:42'],['羅東', '17:30'],['宜蘭', '17:40'],
        ['松山', '18:45'],['臺北', '18:51'],['萬華', '18:56'],['板橋', '19:02'],['樹林', '19:10']
    ]
  },
  '233': {
    '車種': '普悠瑪',
    '車站時間': [
        ['花蓮', '19:25'],['羅東', '20:30'],['宜蘭', '20:40'],['七堵', '21:30'],
        ['松山', '21:45'],['臺北', '21:51'],['萬華', '21:56'],['板橋', '22:02'],
        ['桃園', '22:21'],['新竹', '22:45'],
        ['豐原', '23:20'],['臺中', '23:31'],['彰化', '23:42']
    ]
  },
  '235': {
    '車種': '普悠瑪',
    '車站時間': [
        ['花蓮', '20:25'],['新城', '20:40'],['羅東', '21:30'],['宜蘭', '21:40'],
        ['礁溪', '21:47'],['頭城', '21:52'],['八堵', '22:30'],
        ['松山', '22:45'],['臺北', '22:51'],['萬華', '22:56'],['板橋', '23:02'],['樹林', '23:26']
    ]
  },
  '255': {
    '車種': '普悠瑪',
    '車站時間': [
        ['臺東', '05:25'],['鹿野', '05:35'],['關山', '05:46'],['池上', '05:56'],['玉里', '06:16'],
        ['瑞穗', '06:33'],['光復', '06:45'],['鳳林', '06:55'],['壽豐', '07:05'],['花蓮', '07:20'],
        ['羅東', '08:12'],['宜蘭', '08:20'],
        ['南港', '09:22'],['松山', '09:27'],['臺北', '09:37'],['萬華', '09:42'],['板橋', '09:48'],['樹林', '09:56']
    ]
  },
  '257': {
    '車種': '普悠瑪',
    '車站時間': [
        ['臺東', '07:00'],['玉里', '07:40'],['花蓮', '08:30'],
        ['南港', '10:20'],['松山', '10:25'],['臺北', '10:35'],['萬華', '10:40'],['板橋', '10:46'],['樹林', '10:13']
    ]
  },
  '259': {
    '車種': '普悠瑪',
    '車站時間': [
        ['臺東', '10:25'],['關山', '10:46'],['池上', '10:56'],['玉里', '11:16'],
        ['瑞穗', '11:33'],['光復', '11:45'],['花蓮', '12:20'],
        ['宜蘭', '13:20'],
        ['南港', '14:22'],['松山', '14:27'],['臺北', '14:37'],['萬華', '14:42'],['板橋', '14:48'],['樹林', '14:56']
    ]
  },
  '261': {
    '車種': '普悠瑪',
    '車站時間': [
        ['臺東', '13:00'],['玉里', '13:40'],['花蓮', '14:30'],
        ['南港', '16:20'],['松山', '16:25'],['臺北', '16:35'],['萬華', '16:40'],['板橋', '16:46'],['樹林', '16:13']
    ]
  },
  '263': {
    '車種': '普悠瑪',
    '車站時間': [
        ['臺東', '15:25'],['鹿野', '15:35'],['關山', '15:46'],['池上', '15:56'],['玉里', '16:16'],
        ['瑞穗', '16:33'],['光復', '16:45'],['鳳林', '16:55'],['壽豐', '17:05'],['花蓮', '17:20'],
        ['羅東', '18:12'],['宜蘭', '18:20'],
        ['南港', '19:22'],['松山', '19:27'],['臺北', '19:37'],['萬華', '19:42'],['板橋', '19:48'],['樹林', '19:56']
    ]
  },
  '265': {
    '車種': '普悠瑪',
    '車站時間': [
        ['臺東', '17:00'],['玉里', '17:40'],['花蓮', '18:30'],
        ['南港', '20:20'],['松山', '20:25'],['臺北', '20:35'],['萬華', '20:40'],['板橋', '20:46'],['樹林', '20:13']
    ]
  },
  '267': {
    '車種': '普悠瑪',
    '車站時間': [
        ['臺東', '19:25'],['鹿野', '19:35'],['關山', '19:46'],['池上', '19:56'],['玉里', '20:16'],
        ['瑞穗', '20:33'],['光復', '20:45'],['鳳林', '20:55'],['壽豐', '21:05'],['花蓮', '21:20'],
        ['羅東', '22:12'],['宜蘭', '22:20'],
        ['南港', '23:22'],['松山', '23:27'],['臺北', '23:37'],['萬華', '23:42'],['板橋', '23:48'],['樹林', '23:56']
    ]
  },
 

  //自強號1xx
  '101': {
    '車種': '自強號',
    '車站時間': [
        ['瑞芳', '05:45'],['七堵', '06:00'],['汐止', '06:10'],['松山', '06:20'],['臺北', '06:30'],
        ['萬華', '06:36'],['板橋', '06:42'],
        ['桃園', '07:02'],['中壢', '07:12'],['新竹', '07:43'],
        ['竹南', '07:56'],['苗栗', '07:08'],['豐原', '07:35'],
        ['臺中', '07:47'],['彰化', '08:04'],
        ['員林', '08:15'],['斗六', '08:46'],        
        ['嘉義', '09:11'],['新營', '09:27'],['臺南', '09:54'],
        ['新左營', '10:24'],['高雄', '10:36'],['鳳山', '10:44'],['屏東', '10:59'],['潮州', '11:12']
    ]
},
'103': {
  '車種': '自強號',
  '車站時間': [
      ['臺中', '05:47'],['新烏日', '05:55'],['彰化', '06:04'],
      ['員林', '06:15'],['田中', '06:24'],['斗六', '06:46'],['斗南', '06:54'],        
      ['嘉義', '07:02'],['新營', '07:18'],['善化', '07:33'],['永康', '07:43'],['臺南', '07:53'],
      ['新左營', '08:20'],['高雄', '08:32'],['鳳山', '08:44'],['屏東', '08:55'],['潮州', '09:10'],
      ['南州', '09:20'],['林邊', '09:28'],['枋寮', '09:38']
  ]
},
'105': {
  '車種': '自強號',
  '車站時間': [
      ['基隆', '06:45'],['八堵', '06:53'],['七堵', '07:00'],['汐止', '07:10'],['松山', '07:20'],['臺北', '07:30'],
      ['萬華', '07:36'],['板橋', '07:42'],['樹林', '07:52'],
      ['桃園', '08:07'],['中壢', '08:18'],['湖口', '08:30'],['竹北', '08:45'],['新竹', '08:51'],
      ['竹南', '09:06'],['苗栗', '09:18'],['后里', '09:36'],['豐原', '09:45'],
      ['臺中', '09:58'],['彰化', '10:14'],
      ['員林', '10:25'],['田中', '10:34'],['斗六', '10:56'],['斗南', '11:04'],        
      ['嘉義', '11:11'],['新營', '11:27'],['善化', '11:47'],['臺南', '12:00'],
      ['新左營', '12:27'],['高雄', '12:38'],['鳳山', '12:50'],['屏東', '13:00'],['潮州', '13:15'],
      ['南州', '13:25'],['林邊', '13:33'],['枋寮', '13:43']
  ]
},
'107': {
  '車種': '自強號',
  '車站時間': [
      ['七堵', '08:00'],['汐止', '08:10'],['松山', '08:20'],['臺北', '08:30'],
      ['萬華', '08:36'],['板橋', '08:42'],
      ['桃園', '09:02'],['中壢', '09:12'],['新竹', '09:43'],
      ['竹南', '09:56'],['苗栗', '10:08'],['豐原', '10:35'],
      ['臺中', '10:47'],['彰化', '11:04'],
      ['員林', '11:15'],['斗六', '11:46'],        
      ['嘉義', '12:11'],['新營', '12:27'],['臺南', '12:54'],
      ['新左營', '13:24'],['高雄', '13:36'],['鳳山', '13:44'],['屏東', '13:59'],['潮州', '14:12']
  ]
},
'109' : {
  '車種': '自強號',
  '車站時間': [
      ['七堵', '09:00'],['汐止', '09:10'],['松山', '09:20'],['臺北', '09:30'],
      ['萬華', '09:36'],['板橋', '09:42'],
      ['桃園', '10:02'],['中壢', '10:12'],['新竹', '10:43'],
      ['竹南', '10:56'],['苗栗', '11:08'],['豐原', '11:35'],
      ['臺中', '11:47'],['彰化', '12:04'],
      ['員林', '12:15'],['斗六', '12:46'],['斗南', '12:04'],        
      ['嘉義', '13:11'],['新營', '13:27'],['臺南', '13:54'],
      ['新左營', '14:24'],['高雄', '14:36'],['鳳山', '14:44'],['屏東', '14:59'],['潮州', '15:12']
  ]
},
'111': {
  '車種': '自強號',
  '車站時間': [
    ['七堵', '10:00'],['汐止', '10:10'],['松山', '10:20'],['臺北', '10:30'],
    ['萬華', '10:36'],['板橋', '10:42'],
    ['桃園', '11:02'],['中壢', '11:12'],['新竹', '11:43'],
    ['竹南', '11:56'],['苗栗', '12:08'],['豐原', '12:35'],
    ['臺中', '12:47'],['彰化', '13:04'],
    ['員林', '13:15'],['斗六', '13:46'],        
    ['嘉義', '14:11'],['新營', '14:27'],['臺南', '14:54'],
    ['新左營', '15:24'],['高雄', '15:36'],['鳳山', '15:44'],['屏東', '15:59'],['潮州', '16:12']
  ]
},
'113': {
  '車種': '自強號',
  '車站時間': [
    ['七堵', '11:00'],['汐止', '11:10'],['松山', '11:20'],['臺北', '11:30'],
    ['萬華', '11:36'],['板橋', '11:42'],
    ['桃園', '12:02'],['中壢', '12:12'],['新竹', '12:43'],
    ['竹南', '12:56'],['苗栗', '13:08'],['豐原', '13:35'],
    ['臺中', '13:47'],['彰化', '14:04'],
    ['員林', '14:15'],['斗六', '14:46'],        
    ['嘉義', '15:11'],['新營', '15:27'],['臺南', '15:54'],
    ['新左營', '16:24'],['高雄', '16:36'],['鳳山', '16:44'],['屏東', '16:59'],['潮州', '17:12'],
    ['南州', '17:22'],['林邊', '17:30'],['枋寮', '17:40']
  ]
},
'115': {
  '車種': '自強號',
  '車站時間': [
      ['花蓮', '09:50'],['新城', '10:05'],['南澳', '10:30'],['蘇澳新', '10:54'],['羅東', '11:05'],
      ['宜蘭', '11:15'],['礁溪', '11:22'],['頭城', '11:30'],['福隆', '11:51'],['雙溪', '12:00'],
      ['瑞芳', '12:15'],
      ['七堵', '12:30'],['汐止', '12:40'],['松山', '12:50'],['臺北', '13:00'],
      ['萬華', '13:06'],['板橋', '13:12'],['樹林', '13:22'],
      ['桃園', '13:32'],['中壢', '13:42'],['新竹', '14:13'],
      ['竹南', '14:26'],['苗栗', '14:38'],['豐原', '15:05'],
      ['臺中', '15:17'],['彰化', '15:34'],
      ['員林', '15:45'],['斗六', '16:16'],['斗南', '16:34'],        
      ['嘉義', '16:41'],['新營', '16:57'],['臺南', '17:24'],
      ['新左營', '17:54'],['高雄', '18:06'],['鳳山', '18:14'],['屏東', '18:29'],['潮州', '18:42']
  ]
},
'117': {
  '車種': '自強號',
  '車站時間': [
    ['基隆', '13:15'],['八堵', '13:23'],['七堵', '13:30'],['汐止', '13:40'],['松山', '13:50'],['臺北', '14:00'],
    ['萬華', '14:06'],['板橋', '14:12'],
    ['桃園', '14:32'],['中壢', '14:42'],['新竹', '15:13'],
    ['竹南', '15:26'],['苗栗', '15:38'],['豐原', '16:05'],
    ['臺中', '16:17'],['彰化', '16:34'],
    ['員林', '16:45'],['斗六', '17:16'],        
    ['嘉義', '17:41'],['新營', '17:57'],['臺南', '18:24'],
    ['新左營', '18:54'],['高雄', '19:06'],['鳳山', '19:14'],['屏東', '19:29'],['潮州', '19:42']
  ]
},
'119': {
  '車種': '自強號',
  '車站時間': [
      ['七堵', '15:00'],['汐止', '15:10'],['松山', '15:20'],['臺北', '15:30'],
      ['萬華', '15:36'],['板橋', '15:42'],
      ['桃園', '16:07'],['中壢', '16:18'],['湖口', '16:30'],['竹北', '16:45'],['新竹', '16:51'],
      ['竹南', '17:06'],['苗栗', '17:18'],['后里', '17:36'],['豐原', '17:45'],
      ['臺中', '17:58'],['彰化', '18:14'],
      ['員林', '18:25'],['田中', '18:34'],['斗六', '18:56'],['斗南', '19:04'],        
      ['嘉義', '19:21'],['新營', '19:37'],['善化', '19:57'],['臺南', '20:10'],
      ['新左營', '20:37'],['高雄', '20:48'],['鳳山', '21:00'],['屏東', '21:10'],['潮州', '21:25']
  ]
},
'121': {
  '車種': '自強號',
  '車站時間': [
    ['七堵', '16:00'],['汐止', '16:10'],['松山', '16:20'],['臺北', '16:30'],
    ['萬華', '16:36'],['板橋', '16:42'],
    ['桃園', '17:02'],['中壢', '17:12'],['新竹', '17:43'],
    ['竹南', '17:56'],['苗栗', '18:08'],['豐原', '18:35'],
    ['臺中', '18:47'],['彰化', '19:04'],
    ['員林', '19:15'],['斗六', '19:46'],        
    ['嘉義', '20:11'],['新營', '20:27'],['臺南', '20:57'],
    ['新左營', '21:24'],['高雄', '21:36'],['鳳山', '21:54'],['屏東', '22:09'],['潮州', '22:24']
  ]
},
'123': {
  '車種': '自強號',
  '車站時間': [
    ['基隆', '16:45'],['八堵', '16:53'],['七堵', '17:00'],['汐止', '17:10'],['松山', '17:20'],['臺北', '17:30'],
    ['萬華', '17:36'],['板橋', '17:42'],
    ['桃園', '18:02'],['中壢', '18:12'],['新竹', '18:43'],
    ['竹南', '18:56'],['苗栗', '19:08'],['豐原', '19:35'],
    ['臺中', '19:47'],['彰化', '20:04'],
    ['員林', '20:15'],['斗六', '20:46'],        
    ['嘉義', '21:11'],['新營', '21:27'],['臺南', '21:57'],
    ['新左營', '22:24'],['高雄', '22:36'],['鳳山', '22:54'],['屏東', '23:09'],['潮州', '23:24']
  ]
},
'125': {
  '車種': '自強號',
  '車站時間': [
    ['花蓮', '15:20'],['新城', '15:35'],['南澳', '16:00'],['蘇澳新', '16:24'],['羅東', '16:35'],
    ['宜蘭', '16:45'],['礁溪', '16:52'],['頭城', '17:00'],['福隆', '17:21'],['雙溪', '17:30'],
    ['瑞芳', '17:45'],['七堵', '18:00'],['汐止', '18:10'],['松山', '18:20'],['臺北', '18:30'],
    ['萬華', '18:36'],['板橋', '18:42'],
    ['桃園', '19:02'],['中壢', '19:12'],['新竹', '19:43'],
    ['竹南', '19:56'],['苗栗', '20:08'],['豐原', '20:35'],
    ['臺中', '20:47'],['彰化', '21:04'],
    ['員林', '21:15'],['斗六', '21:46'],        
    ['嘉義', '22:11'],['新營', '22:27'],['臺南', '22:57'],
    ['新左營', '23:24'],['高雄', '23:36'],['鳳山', '23:54'],['屏東', '00:09'],['潮州', '00:24']
  ]
},
'127': {
  '車種': '自強號',
  '車站時間': [
    ['瑞芳', '19:00'],['七堵', '19:15'],['松山', '19:35'],['臺北', '19:45'],
    ['萬華', '19:51'],['板橋', '19:57'],
    ['桃園', '20:17'],['中壢', '20:27'],['新竹', '20:58'],
    ['竹南', '21:11'],['苗栗', '21:23'],['豐原', '21:50'],
    ['臺中', '22:02'],['彰化', '22:19'],
    ['員林', '22:30'],['斗六', '23:01'],       
    ['嘉義', '23:26'],['新營', '23:42'],['臺南', '23:12'],
    ['新左營', '23:39'],['高雄', '23:51'],['鳳山', '00:09'],['屏東', '00:24']
  ]
},
'129': {
  '車種': '自強號',
  '車站時間': [
    ['七堵', '20:45'], ['松山', '21:05'], ['臺北', '21:15'],
    ['萬華', '21:21'], ['板橋', '21:27'],
    ['桃園', '21:47'], ['中壢', '21:57'], ['新竹', '22:28'],
    ['竹南', '22:41'], ['苗栗', '22:53'], ['豐原', '23:20'],
    ['臺中', '23:32'], ['彰化', '23:49'],
    ['員林', '00:00'], ['斗六', '00:31']
  ]
},
'131': {
  '車種': '自強號',
  '車站時間': [
    ['七堵', '21:00'],['汐止', '21:10'],['松山', '21:20'],['臺北', '21:30'],
    ['萬華', '21:36'],['板橋', '21:42'],['樹林', '21:52'],
    ['桃園', '22:07'],['中壢', '22:18'],['湖口', '22:30'],['竹北', '22:45'],['新竹', '22:51'],
    ['竹南', '23:06'],['苗栗', '23:18'],['后里', '23:36'],['豐原', '23:45'],
    ['臺中', '23:58'],['彰化', '00:14']
  ]
},
'133': {
  '車種': '自強號',
  '車站時間': [
    ['花蓮', '21:00'],['新城', '21:15'],['南澳', '21:40'],['蘇澳新', '22:04'],['羅東', '22:15'],
    ['宜蘭', '22:25'],['礁溪', '22:32'],['頭城', '22:40'],['福隆', '23:01'],['雙溪', '23:10'],
    ['瑞芳', '23:25'],['八堵', '23:37'],['汐止', '23:50'],['松山', '00:00'],['臺北', '00:10'],
    ['萬華', '00:16'],['板橋', '00:22'],['樹林', '00:30']
  ]
},
'135': {
  '車種': '自強號',
  '車站時間': [
      ['彰化', '17:14'],['員林', '17:25'],['田中', '17:34'],['斗六', '17:56'],['斗南', '18:04'],        
      ['嘉義', '18:21'],['新營', '18:37'],['善化', '18:57'],['臺南', '19:10'],
      ['新左營', '19:37'],['高雄', '19:48'],['鳳山', '20:00'],['屏東', '20:10'],['潮州', '20:25'],
      ['南州', '20:35'],['林邊', '20:43'],['枋寮', '20:53']
    ]
},



  //莒光號4xx

  //區間快2xxx

  //區間車1xxx

  //復興號5xx

  //加班車5xxx

};

var stations = [
  '臺東', '鹿野', '關山', '池上', '富里', '玉里', '瑞穗', '光復', '萬榮', '鳳林',
    '壽豐', '志學', '吉安', '花蓮', '新城', '和平', '南澳', '東澳', '蘇澳新', '冬山',
    '羅東', '宜蘭', '礁溪', '頭城', '福隆', '雙溪', '瑞芳', '基隆', '八堵', '七堵',
    '汐止', '汐科', '南港', '松山', '臺北', '萬華', '板橋', '樹林', '鶯歌', '桃園',
    '中壢', '楊梅', '湖口', '竹北', '新竹', '竹南', '苗栗', '銅鑼', '三義', '后里',
    '豐原', '潭子', '臺中', '新烏日', '彰化', '員林', '社頭', '田中', '二水', '斗六',
    '斗南', '民雄', '嘉義', '新營', '善化', '永康', '臺南', '岡山', '新左營', '高雄',
    '鳳山', '九曲堂', '屏東', '西勢', '潮州', '南州', '林邊', '枋寮'
];


console.log('trainSchedule:', trainSchedule);
console.log('stations:', stations);

// 動態生成車站下拉選單
// 動態生成車站下拉選單
function generateStationOptions() {
  var startStationSelect = document.getElementById('startStation');
  var endStationSelect = document.getElementById('endStation');
  var stationSelect = document.getElementById('stationSelect');

  for (var i = 0; i < stations.length; i++) {
      var option1 = document.createElement('option');
      option1.value = stations[i];
      option1.text = stations[i];
      startStationSelect.add(option1);

      var option2 = option1.cloneNode(true);
      endStationSelect.add(option2);

      var option3 = option1.cloneNode(true);
      stationSelect.add(option3);
  }
}

// 初始化生成車站下拉選單
generateStationOptions();


// 查詢時刻表的函數（原先的函數）
function filterTrainScheduleByStation() {
  var startStation = document.getElementById('startStation').value;
  var endStation = document.getElementById('endStation').value;

  var scheduleTable = document.getElementById('scheduleTableByStation').getElementsByTagName('tbody')[0];
  scheduleTable.innerHTML = ''; // Clear previous content

  var matchingTrains = [];

  for (var trainNumberKey in trainSchedule) {
      var stationTimes = trainSchedule[trainNumberKey]['車站時間'];
      var startIndex = stationTimes.findIndex(station => station[0] === startStation);
      var endIndex = stationTimes.findIndex(station => station[0] === endStation);

      if (startIndex !== -1 && endIndex !== -1 && startIndex < endIndex) {
          matchingTrains.push({
              trainNumber: trainNumberKey,
              trainType: getTrainTypeWithColor(trainSchedule[trainNumberKey]['車種']),
              startStation: stationTimes[startIndex][0],
              endStation: stationTimes[endIndex][0],
              startTime: stationTimes[startIndex][1],
              endTime: stationTimes[endIndex][1]
          });
      }
  }

  // Sort the matchingTrains array by start time
  matchingTrains.sort(function (a, b) {
      return a.startTime.localeCompare(b.startTime);
  });

  // Populate the schedule table with the sorted data
  for (var i = 0; i < matchingTrains.length; i++) {
      var row = scheduleTable.insertRow();
      var cell1 = row.insertCell(0);
      var cell2 = row.insertCell(1);
      var cell3 = row.insertCell(2);
      var cell4 = row.insertCell(3);
      var cell5 = row.insertCell(4);
      var cell6 = row.insertCell(5);

      cell1.innerHTML = matchingTrains[i].trainNumber;
      cell2.innerHTML = matchingTrains[i].trainType;
      cell3.innerHTML = matchingTrains[i].startStation;
      cell4.innerHTML = matchingTrains[i].endStation;
      cell5.innerHTML = matchingTrains[i].startTime;
      cell6.innerHTML = matchingTrains[i].endTime;

      row.setAttribute('onclick', 'showTrainDetails(\'' + matchingTrains[i].trainNumber + '\')');
  }
}



function filterTrainScheduleByNumber() {
  var trainNumber = document.getElementById('trainNumber').value;

  var scheduleTable = document.getElementById('scheduleTableByNumber').getElementsByTagName('tbody')[0];
  scheduleTable.innerHTML = ''; // Clear previous content

  if (trainSchedule[trainNumber]) {
      var stationTimes = trainSchedule[trainNumber]['車站時間'];

      var row = scheduleTable.insertRow();
      var cell1 = row.insertCell(0);
      var cell2 = row.insertCell(1);

      cell1.innerHTML = trainNumber;
      cell2.innerHTML = trainSchedule[trainNumber]['車種'];

      row.setAttribute('onclick', 'showTrainDetails(\'' + trainNumber + '\')');

      // Show detailed information in the modal
      var modalTitle = document.getElementById('modalTitle');
      var modalTable = document.getElementById('modalTable');
      var modalBody = modalTable.getElementsByTagName('tbody')[0];
      modalBody.innerHTML = ''; // Clear previous content

      modalTitle.innerHTML = '列車詳細資訊 - 車次' + trainNumber  ;

      for (var i = 0; i < stationTimes.length; i++) {
          var rowModal = modalBody.insertRow();
          var cell1Modal = rowModal.insertCell(0);
          var cell2Modal = rowModal.insertCell(1);

          cell1Modal.innerHTML = stationTimes[i][0];
          cell2Modal.innerHTML = stationTimes[i][1];
      }
  }
}

function filterTrainScheduleByStationName() {
  var selectedStation = document.getElementById('stationSelect').value;

  var scheduleTable = document.getElementById('scheduleTableByStationName').getElementsByTagName('tbody')[0];
  scheduleTable.innerHTML = ''; // Clear previous content

  // 將列車數據轉換為數組並根據車站時間排序
  var sortedTrains = Object.keys(trainSchedule).sort(function (a, b) {
    var timeA = getDepartureTimeForStation(a, selectedStation);
    var timeB = getDepartureTimeForStation(b, selectedStation);
    return timeA.localeCompare(timeB);
  });

  // 遍歷排序後的列車數組
  for (var i = 0; i < sortedTrains.length; i++) {
    var trainNumberKey = sortedTrains[i];
    var stationTimes = trainSchedule[trainNumberKey]['車站時間'];

    // 查找所选择车站的索引
    var stationIndex = stationTimes.findIndex(stationInfo => stationInfo[0] === selectedStation);

    // 只显示有停靠所选择车站的列车信息
    if (stationIndex !== -1) {
      var row = scheduleTable.insertRow();
      var cell1 = row.insertCell(0);
      var cell2 = row.insertCell(1);
      var cell3 = row.insertCell(2);

      cell1.innerHTML = trainNumberKey;
      cell2.innerHTML = getTrainTypeWithColor(trainSchedule[trainNumberKey]['車種']);
      cell3.innerHTML = stationTimes[stationIndex][1];

      row.setAttribute('onclick', 'showTrainDetails(\'' + trainNumberKey + '\')');
    }
  }
}

// 使用 getDepartureTimeForStation 函数获取指定列车在指定站点的出发时间
function getDepartureTimeForStation(trainNumber, station) {
  var stationTimes = trainSchedule[trainNumber]['車站時間'];
  var stationIndex = stationTimes.findIndex(stationInfo => stationInfo[0] === station);
  return stationIndex !== -1 ? stationTimes[stationIndex][1] : '';
}








function showTrainDetails(trainNumber) {
  var modalTitle = document.getElementById('modalTitle');
  var modalTable = document.getElementById('modalTable');
  var modalBody = modalTable.getElementsByTagName('tbody')[0];
  modalBody.innerHTML = ''; // Clear previous content

  modalTitle.innerHTML = '列車詳細資訊 - 車次 ' + trainNumber;

  var stationTimes = trainSchedule[trainNumber]['車站時間'];
  for (var i = 0; i < stationTimes.length; i++) {
      var row = modalBody.insertRow();
      var cell1 = row.insertCell(0);
      var cell2 = row.insertCell(1);

      cell1.innerHTML = stationTimes[i][0];
      cell2.innerHTML = stationTimes[i][1];
  }




  document.getElementById('trainDetailsModal').style.display = 'block';
}

function closeTrainDetailsModal() {
  document.getElementById('trainDetailsModal').style.display = 'none';
}

// 新增的 JavaScript 部分
function generateStationFilterOptions() {
  var stationFilterSelect = document.getElementById('stationFilter');

  for (var i = 0; i < stations.length; i++) {
      var option = document.createElement('option');
      option.value = stations[i];
      option.text = stations[i];
      stationFilterSelect.add(option);
  }
}

function filterTrainsByStation() {
  var selectedStation = document.getElementById('stationFilter').value;

  var filteredTrainsTable = document.getElementById('filteredTrainsTable').getElementsByTagName('tbody')[0];
  filteredTrainsTable.innerHTML = ''; // Clear previous content

  for (var trainNumberKey in trainSchedule) {
      var stationTimes = trainSchedule[trainNumberKey]['車站時間'];
      var stationIndex = stationTimes.findIndex(station => station[0] === selectedStation);

      if (stationIndex !== -1) {
          var row = filteredTrainsTable.insertRow();
          var cell1 = row.insertCell(0);
          var cell2 = row.insertCell(1);
          var cell3 = row.insertCell(2);

          cell1.innerHTML = trainNumberKey;
          cell2.innerHTML = getTrainTypeWithColor(trainSchedule[trainNumberKey]['車種']);
          cell3.innerHTML = stationTimes[stationIndex][1];
      }
  }
}

function getTrainTypeWithColor(trainType) {
  var color = '';

  switch (trainType) {
      case '新自強':
          color = 'purple';
          break;
      case '普悠瑪':
          color = '#FF1493'; // Deep Pink
          break;
      case '自強號':
          color = 'red';
          break;
      case '莒光號':
          color = 'orange';
          break;
      case '區間快':
          color = 'green';
          break;
      case '復興號':
          color = 'lightblue';
          break;
      case '區間車':
          color = 'black';
          break;
      case '加班車':
          color = 'brown';
          break;
      default:
          color = 'black';
  }

  return '<span style="color: ' + color + ';">' + trainType + '</span>';
}



// 新增幫助函數
function getArrivalTimeForStation(trainNumber, station) {
  var stationTimes = trainSchedule[trainNumber]['車站時間'];
  var stationIndex = stationTimes.findIndex(s => s[0] === station);
  
  if (stationIndex !== -1) {
      return stationTimes[stationIndex][1];
  }
  return null;
}

