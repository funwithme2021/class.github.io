<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>颱風預測路徑繪圖系統</title>
    <style>
        #map {
            height: 600px;
            width: 100%;
        }
        .form-container {
            margin: 20px;
        }
        .form-container div {
            margin-bottom: 10px;
        }
        .form-container label {
            margin-right: 10px;
        }
        .time-label {
            background-color: white;
            border: 1px solid black;
            padding: 2px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="form-container">
        <h2>輸入路徑數據</h2>
        <form id="typhoon-form">
            <div>
                <label>經度：</label>
                <input type="number" step="0.000001" id="longitude" required>
            </div>
            <div>
                <label>緯度：</label>
                <input type="number" step="0.000001" id="latitude" required>
            </div>
            <div>
                <label>強度：</label>
                <select id="intensity" required>
                    <option value="TD">熱帶性低氣壓</option>
                    <option value="TS">輕度颱風</option>
                    <option value="ST">中度颱風</option>
                    <option value="TY">強烈颱風</option>
                </select>
            </div>
            <div>
                <label>誤差範圍 (公里)：</label>
                <input type="number" id="error-radius" required>
            </div>
            <div>
                <label>時間：</label>
                <input type="datetime-local" id="timestamp">
            </div>
            <div>
                <button type="button" onclick="addCurrentPoint()">設定現在位置</button>
                <button type="button" onclick="addPastPoint()">添加過去位置</button>
                <button type="button" onclick="addFuturePoint()">添加未來位置</button>
            </div>
        </form>
    </div>

    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
    <script>
        var map;
        var pastPath = [];
        var futurePath = [];
        var currentMarker = null;
        var currentCircle = null;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 23.5, lng: 121},
                zoom: 6,
                styles: [
                    {
                        elementType: 'geometry',
                        stylers: [{color: '#102432'}]
                    },
                    {
                        elementType: 'labels.text.stroke',
                        stylers: [{color: '#242f3e'}]
                    },
                    {
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#746855'}]
                    },
                    {
                        featureType: 'administrative.locality',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#d59563'}]
                    },
                    {
                        featureType: 'poi',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#d59563'}]
                    },
                    {
                        featureType: 'poi.park',
                        elementType: 'geometry',
                        stylers: [{color: '#263c3f'}]
                    },
                    {
                        featureType: 'poi.park',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#6b9a76'}]
                    },
                    {
                        featureType: 'road',
                        elementType: 'geometry',
                        stylers: [{color: '#38414e'}]
                    },
                    {
                        featureType: 'road',
                        elementType: 'geometry.stroke',
                        stylers: [{color: '#212a37'}]
                    },
                    {
                        featureType: 'road',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#9ca5b3'}]
                    },
                    {
                        featureType: 'road.highway',
                        elementType: 'geometry',
                        stylers: [{color: '#746855'}]
                    },
                    {
                        featureType: 'road.highway',
                        elementType: 'geometry.stroke',
                        stylers: [{color: '#1f2835'}]
                    },
                    {
                        featureType: 'road.highway',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#f3d19c'}]
                    },
                    {
                        featureType: 'transit',
                        elementType: 'geometry',
                        stylers: [{color: '#2f3948'}]
                    },
                    {
                        featureType: 'transit.station',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#d59563'}]
                    },
                    {
                        featureType: 'water',
                        elementType: 'geometry',
                        stylers: [{color: '#17263c'}]
                    },
                    {
                        featureType: 'water',
                        elementType: 'labels.text.fill',
                        stylers: [{color: '#515c6d'}]
                    },
                    {
                        featureType: 'water',
                        elementType: 'labels.text.stroke',
                        stylers: [{color: '#17263c'}]
                    }
                ]
            });
        }

        function addCurrentPoint() {
            var lat = parseFloat(document.getElementById('latitude').value);
            var lng = parseFloat(document.getElementById('longitude').value);
            var intensity = document.getElementById('intensity').value;
            var errorRadius = parseFloat(document.getElementById('error-radius').value);

            if (currentMarker) {
                currentMarker.setMap(null);
            }
            if (currentCircle) {
                currentCircle.setMap(null);
            }

            var iconUrl = getIconUrl(intensity);
            currentMarker = new google.maps.Marker({
                position: {lat: lat, lng: lng},
                map: map,
                icon: iconUrl
            });

            currentCircle = new google.maps.Circle({
                strokeColor: '#FF0000',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#FF0000',
                fillOpacity: 0.35,
                map: map,
                center: {lat: lat, lng: lng},
                radius: errorRadius * 1000
            });
        }

        function addPastPoint() {
            var lat = parseFloat(document.getElementById('latitude').value);
            var lng = parseFloat(document.getElementById('longitude').value);
            var intensity = document.getElementById('intensity').value;
            var errorRadius = parseFloat(document.getElementById('error-radius').value);

            var point = {lat: lat, lng: lng};
            pastPath.push(point);

            if (pastPath.length > 1) {
                var path = new google.maps.Polyline({
                    path: pastPath,
                    geodesic: true,
                    strokeColor: '#0000FF',
                    strokeOpacity: 1.0,
                    strokeWeight: 2
                });
                path.setMap(map);
            }

            var iconUrl = getIconUrl(intensity);
            new google.maps.Marker({
                position: point,
                map: map,
                icon: iconUrl
            });

            new google.maps.Circle({
                strokeColor: '#0000FF',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#0000FF',
                fillOpacity: 0.35,
                map: map,
                center: point,
                radius: errorRadius * 1000
            });
        }

        function addFuturePoint() {
            var lat = parseFloat(document.getElementById('latitude').value);
            var lng = parseFloat(document.getElementById('longitude').value);
            var intensity = document.getElementById('intensity').value;
            var errorRadius = parseFloat(document.getElementById('error-radius').value);
            var timestamp = document.getElementById('timestamp').value;

            var point = {lat: lat, lng: lng};
            futurePath.push(point);

            if (currentMarker) {
                var path = new google.maps.Polyline({
                    path: [currentMarker.getPosition(), point],
                    geodesic: true,
                    strokeColor: '#FF0000',
                    strokeOpacity: 1.0,
                    strokeWeight: 2,
                    icons: [{
                        icon: {path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW},
                        offset: '100%'
                    }]
                });
                path.setMap(map);
            }

            var iconUrl = getIconUrl(intensity);
            var futureMarker = new google.maps.Marker({
                position: point,
                map: map,
                icon: iconUrl
            });

            new google.maps.Circle({
                strokeColor: '#FF0000',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillOpacity: 0,
map: map,
center: point,
radius: errorRadius * 1000
});
var infowindow = new google.maps.InfoWindow({
            content: '<div class="time-label">時間：' + timestamp + '</div>'
        });
        infowindow.open(map, futureMarker);
    }

    function getIconUrl(intensity) {
        switch (intensity) {
            case 'TD':
                return 'td.png';
            case 'TS':
                return 'ts.png';
            case 'ST':
                return 'st.png';
            case 'TY':
                return 'ty.png';
            default:
                return 'images/default.png';
        }
    }

    google.maps.event.addDomListener(window, 'load', initMap);
</script>
</body>
</html>
